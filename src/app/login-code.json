
{
  "filePath": "src/app/login/page.tsx",
  "code": "'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { useAuth } from '@/firebase';\nimport PrimaryButton from '@/components/ui/PrimaryButton';\nimport { useToast } from '@/hooks/use-toast';\nimport { z } from 'zod';\nimport { signInWithEmailAndPassword } from 'firebase/auth';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Eye, EyeOff } from 'lucide-react';\n\nconst LoginSchema = z.object({\n  email: z.string().email({ message: 'Geçerli bir e-posta adresi girin.' }),\n  password: z\n    .string()\n    .min(6, { message: 'Şifre en az 6 karakter olmalıdır.' }),\n});\n\nexport default function LoginPage() {\n  const auth = useAuth();\n  const router = useRouter();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n  \n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [rememberMe, setRememberMe] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  \n  useEffect(() => {\n    try {\n      const saved = localStorage.getItem('qrstock-login');\n      if (saved) {\n        const parsed = JSON.parse(saved);\n        if (parsed.email) {\n          setEmail(parsed.email);\n          setRememberMe(true);\n        }\n      }\n    } catch (e) {\n      console.warn('Kaydedilmiş giriş bilgileri okunamadı', e);\n    }\n  }, []);\n  \n  const handleLogin = async (e?: React.FormEvent) => {\n    e?.preventDefault();\n    setIsLoading(true);\n    \n    const validation = LoginSchema.safeParse({ email, password });\n    if (!validation.success) {\n      toast({ variant: 'destructive', title: 'Doğrulama Hatası', description: validation.error.errors[0].message });\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n        const userCredential = await signInWithEmailAndPassword(auth, email, password);\n        \n        if (rememberMe) {\n          localStorage.setItem('qrstock-login', JSON.stringify({ email }));\n        } else {\n          localStorage.removeItem('qrstock-login');\n        }\n\n        const idToken = await userCredential.user.getIdToken(true);\n\n        const res = await fetch('/api/session', {\n            method:'POST',\n            headers:{ 'Content-Type':'application/json' },\n            body: JSON.stringify({ idToken }),\n        });\n\n        if (!res.ok) {\n          const errorText = await res.text();\n          throw new Error(errorText || 'Oturum oluşturulurken bir hata oluştu.');\n        }\n        \n        router.push('/dashboard');\n\n    } catch (error: any) {\n      let description = 'E-posta veya şifre yanlış.';\n      if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {\n        description = 'E-posta veya şifre yanlış.';\n      } else {\n        description = error.message;\n      }\n      toast({ variant: 'destructive', title: 'Giriş Başarısız', description });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col min-h-dvh p-4 bg-app-bg\">\n        <div className=\"flex-1 flex flex-col justify-center\">\n            <h1 className=\"text-3xl font-extrabold text-text mb-4\">Giriş Yap</h1>\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">E-posta</Label>\n                <Input id=\"email\" type=\"email\" placeholder=\"ornek@sirket.com\" value={email} onChange={(e) => setEmail(e.target.value)} required />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Şifre</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"password\"\n                    name=\"password\"\n                    type={showPassword ? 'text' : 'password'}\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"pr-10\"\n                    placeholder=\"••••••••\"\n                    required\n                  />\n                  <button\n                    type=\"button\"\n                    className=\"absolute inset-y-0 right-0 flex items-center pr-3 text-muted-foreground\"\n                    onMouseDown={() => setShowPassword(true)}\n                    onMouseUp={() => setShowPassword(false)}\n                    onMouseLeave={() => setShowPassword(false)}\n                    onTouchStart={() => setShowPassword(true)}\n                    onTouchEnd={() => setShowPassword(false)}\n                  >\n                    {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                  </button>\n                </div>\n              </div>\n              \n               <div className=\"flex items-center justify-between\">\n                <label className=\"flex items-center gap-2 text-sm text-muted-foreground cursor-pointer\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary\"\n                    checked={rememberMe}\n                    onChange={(e) => setRememberMe(e.target.checked)}\n                  />\n                  Beni hatırla\n                </label>\n                 <Link href=\"/forgot-password\" className=\"text-primary text-sm font-semibold\">\n                    Şifremi unuttum\n                </Link>\n              </div>\n\n              <PrimaryButton title=\"Giriş Yap\" type=\"submit\" disabled={isLoading} />\n            </form>\n        </div>\n        <p className=\"text-center text-subtext text-sm pb-4\">\n            Hesabınız yok mu?{' '}\n            <Link href=\"/register\" className=\"font-bold text-primary\">\n                Kayıt Olun\n            </Link>\n        </p>\n    </div>\n  );\n}\n"
}
